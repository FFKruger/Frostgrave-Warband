<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Frostgrave Warband Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #eaf2f8; margin: 0; }
        main { max-width: 700px; margin: 2em auto 2em auto; background: #fff; border-radius: 10px; padding: 2em 2.5em; box-shadow: 0 6px 28px #bbb8; }
        h1 { text-align: center; margin-bottom: 0.7em; }
        h2 { color: #2e4053; }
        nav { text-align: center; margin-bottom: 1.5em; }
        nav button { background: #eaf2f8; border: 1px solid #bbb; border-radius: 8px 8px 0 0; padding: 0.7em 2em; font-size: 1.1em; margin-right: 0.2em; cursor: pointer;}
        nav button.active, nav button:hover { background: #3498db; color: #fff;}
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .vertical-list { display: flex; flex-direction: column; gap: 1.5em; margin-bottom: 2em; }
        .person-card, .active-beast-card {
            background: #fafdff;
            border-radius: 10px;
            box-shadow: 0 1px 8px #bbb3;
            padding: 1.3em 1.1em 1em 1.1em;
            width: 100%;
            position: relative;
            margin-bottom: 0;
        }
        .active-beast-card { border: 2px solid #c0392b; background: #fff6f6; }
        .person-header { font-size: 1.16em; margin-bottom: .7em;}
        .tipo-mago { color: #1a5276; font-weight: bold; }
        .tipo-aprendiz { color: #8e44ad; font-weight: bold; }
        .tipo-soldado { color: #16a085; font-weight: bold; }
        .soldado-elite { color: #c0392b; }
        .stats-line { display: flex; align-items: center; gap: 1.25em; margin-bottom: .6em; padding: 0.6em 0; background: #f2f7fa; border-radius: 6px;}
        .stat-label { font-weight: 600; margin-right: 0.2em; color: #2c3e50;}
        .stat-value { width: 2.2em; text-align: center; }
        .hp-box { display: flex; align-items: center; gap: 0.2em;}
        .hp-btn { background: #3498db; color: #fff; border: none; border-radius: 5px; font-size: 1.1em; width: 2em; height: 2em; cursor: pointer;}
        .hp-btn:active { background: #2471a3; }
        .hp-value { width: 2.3em; text-align: center; font-size: 1.09em; border: 1px solid #bbb; border-radius: 5px; margin: 0 0.2em;}
        .remove-btn { margin-left: 4px; background: #c0392b; color: #fff; border: none; border-radius: 5px; font-size: 0.97em; padding: 0.18em 0.7em; cursor: pointer; }
        .remove-btn:active { background: #922b21; }
        .notes-box { width: 100%; min-height: 80px; border-radius:6px; border: 1px solid #bbb; padding: .7em; font-size: 1.07em; margin-bottom: 1em;}
        .add-form select { min-width: 160px; }
        .personagem-destacado { border: 2px solid #3498db !important; background: #e8f4fb !important; }
        .add-mago-aprendiz-btns { margin-bottom: 2em; }
        .add-mago-aprendiz-btns button { margin-right: 1em; background: #3498db; color: #fff; font-weight: bold; border: none; border-radius: 7px; padding: 0.6em 1.4em; font-size: 1em; cursor: pointer;}
        .add-mago-aprendiz-btns button:last-child { margin-right: 0;}
        .add-mago-aprendiz-btns button:active { background: #2471a3; }
        .add-form-soldado { margin-bottom: 2em;}
        .badge-limit { display:inline-block; background: #d35400; color:#fff; font-size:0.9em; border-radius:5px; padding: 0 .4em; margin-left:.5em; }
        .badge-el { background: #c0392b; }
        .badge-norm { background: #3498db;}
        .soldado-limit-alert {color:#c0392b;font-weight:bold; margin-bottom:1em;}
        .magias-list, .itens-list { margin: 0.4em 0 0 1.2em; font-size: 0.97em; }
        .person-magias { margin-top: 0.5em; padding-left: 1.1em; color: #1a5276; font-size: 0.98em; }
        .magia-form, .item-form { margin-bottom: 1.2em; }
        .magia-form select, .item-form select { min-width: 200px; margin-right: 1em;}
        .beast-card, .active-beast-card { margin-bottom: 1.2em;}
        .beast-header { font-size: 1.13em; font-weight: bold; margin-bottom: .5em; }
        .beast-type { color: #c0392b; font-weight: bold; }
        .beast-desc { color: #222; font-size: 0.98em; font-style: italic; margin-bottom: .7em;}
        .select-beast-btn { position: absolute; top: 10px; right: 10px; background: #e67e22; color: #fff; border: none; border-radius: 5px; font-size: 0.97em; padding: 0.18em 0.7em; cursor: pointer;}
        .select-beast-btn.selected { background: #229954; }
        .beast-tooltip { position: relative; cursor: help; border-bottom: 1px dotted #aaa; }
        .beast-tooltip .tooltiptext {
            visibility: hidden;
            width: 265px;
            background-color: #222;
            color: #fff;
            text-align: left;
            border-radius: 9px;
            padding: 0.7em 1em;
            position: absolute;
            z-index: 10;
            top: 145%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.22s;
            font-size: 1em;
            box-shadow: 0 3px 18px #0008;
        }
        .beast-tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }
        .bestiary-list { margin-top: 1.2em; }
        .bestiary-group { margin-bottom: 2.5em; }
        .bestiary-group h3 { color: #c0392b; margin-bottom: 0.7em; }
        .active-beasts-list { display: flex; flex-direction: column; gap: 1.2em; margin-bottom: 2em; }
        @media (max-width: 700px) {
            main { padding: 0.5em 0.3em; }
        }
    </style>
</head>
<body>
<main>
    <h1>Frostgrave Warband Manager</h1>
    <nav id="tabnav">
        <button data-tab="dashboard" class="active" type="button">Dashboard</button>
        <button data-tab="magias" type="button">Magias</button>
        <button data-tab="itens" type="button">Itens</button>
        <button data-tab="notas" type="button">Notas</button>
        <button data-tab="bestiario" type="button">Bestiário</button>
    </nav>
    <section id="dashboard" class="tab-content active">
        <h2>Magos</h2>
        <div class="vertical-list" id="mago-lista"></div>
        <div class="add-mago-aprendiz-btns">
            <button onclick="adicionarMago()">+ Adicionar Mago</button>
        </div>
        <h2>Aprendizes</h2>
        <div class="vertical-list" id="aprendiz-lista"></div>
        <div class="add-mago-aprendiz-btns">
            <button onclick="adicionarAprendiz()">+ Adicionar Aprendiz</button>
        </div>
        <h2>Soldados</h2>
        <div class="vertical-list" id="soldado-lista"></div>
        <section class="add-section">
            <h2>Adicionar Soldado</h2>
            <div class="soldado-limit-alert" id="soldado-limit-alert"></div>
            <form class="add-form add-form-soldado" id="add-soldado-form" onsubmit="adicionarSoldado(event)">
                <label>
                    Tipo de Soldado:
                    <select id="soldado-tipo"></select>
                </label>
                <label>
                    Nome:
                    <input id="soldado-nome" type="text" maxlength="40" placeholder="Opcional">
                </label>
                <button type="submit">Adicionar Soldado</button>
            </form>
        </section>
    </section>
    <section id="magias" class="tab-content">
        <h2>Banco de Magias</h2>
        <form class="magia-form" onsubmit="adicionarBancoMagia(event)">
            <select id="magia-dropdown"></select>
            <input id="magia-comp" type="text" placeholder="Descrição completa (opcional)">
            <button type="submit">Adicionar Magia</button>
        </form>
        <ul id="banco-magias-lista" class="magias-list"></ul>
    </section>
    <section id="itens" class="tab-content">
        <h2>Banco de Itens</h2>
        <form class="item-form" onsubmit="adicionarBancoItem(event)">
            <select id="item-dropdown"></select>
            <input id="item-efeito" type="text" placeholder="Efeito extra (opcional)">
            <button type="submit">Adicionar Item</button>
        </form>
        <ul id="banco-itens-lista" class="itens-list"></ul>
    </section>
    <section id="notas" class="tab-content">
        <h2>Anotações da Warband</h2>
        <textarea class="notes-box" id="notas-box" placeholder="Anote estratégias, progresso, tesouros, eventos..."></textarea>
    </section>
    <section id="bestiario" class="tab-content">
        <h2>Bestiário</h2>
        <div id="active-beasts-list" class="active-beasts-list"></div>
        <div id="bestiary-list" class="bestiary-list"></div>
    </section>
</main>
<script>
// --- Exemplo reduzido dos dados, ajuste conforme o seu projeto completo ---
let personagens = [];
let bancoMagias = [];
let bancoItens = [];
let magiasPorPersonagem = {};
let bestiarioAtivo = [];

const STATS = {
    "Mago":      { move:6, fight:"+2", shoot:"+0", armor:10, will:"+4", hp:14 },
    "Aprendiz":  { move:6, fight:"+1", shoot:"+0", armor:10, will:"+2", hp:10 },
    "Thief":           { move:7, fight:"+1", shoot:"0", armor:10, will:"0", hp:10 },
    "Thug":            { move:6, fight:"+2", shoot:"0", armor:10, will:"0", hp:10 },
    "War Dog":         { move:8, fight:"+1", shoot:"0", armor:10, will:"0", hp:8 },
    "Infantryman":     { move:6, fight:"+2", shoot:"0", armor:12, will:"0", hp:12 },
    "Man-at-Arms":     { move:6, fight:"+3", shoot:"0", armor:13, will:"0", hp:12 },
    "Archer":          { move:6, fight:"0", shoot:"+2", armor:11, will:"0", hp:10 },
    "Barbarian":       { move:6, fight:"+4", shoot:"0", armor:10, will:"0", hp:12 },
    "Crossbowman":     { move:6, fight:"0", shoot:"+2", armor:11, will:"0", hp:10 },
    "Knight":          { move:6, fight:"+3", shoot:"0", armor:14, will:"0", hp:12 },
    "Marksman":        { move:6, fight:"0", shoot:"+3", armor:11, will:"0", hp:10 },
    "Ranger":          { move:7, fight:"+2", shoot:"+2", armor:11, will:"0", hp:12 },
    "Templar":         { move:6, fight:"+4", shoot:"0", armor:12, will:"0", hp:12 },
    "Tracker":         { move:7, fight:"+1", shoot:"+2", armor:11, will:"0", hp:10 },
    "Treasure Hunter": { move:7, fight:"+3", shoot:"0", armor:12, will:"0", hp:12 },
    "Apothecary":      { move:6, fight:"0", shoot:"0", armor:10, will:"0", hp:10 },
    "Crowmaster":      { move:6, fight:"0", shoot:"0", armor:10, will:"0", hp:10 },
    "Pack Mule":       { move:6, fight:"0", shoot:"0", armor:10, will:"0", hp:10 },
    "Trap Expert":     { move:7, fight:"0", shoot:"0", armor:10, will:"0", hp:10 },
    "Witch Doctor":    { move:6, fight:"0", shoot:"0", armor:10, will:"0", hp:10 }
};
const SOLDADOS_NORMAIS = ["Thief", "Thug", "War Dog", "Infantryman", "Man-at-Arms"];
const SOLDADOS_ELITES = ["Archer", "Barbarian", "Crossbowman", "Knight", "Marksman", "Ranger", "Templar", "Tracker", "Treasure Hunter", "Apothecary", "Crowmaster", "Pack Mule", "Trap Expert", "Witch Doctor"];

// --- Renderização dos personagens um abaixo do outro ---

function renderPersonagens() {
    // Magos
    const magoDiv = document.getElementById('mago-lista');
    magoDiv.innerHTML = '';
    personagens
        .filter(p => p.tipo === "Mago")
        .forEach((pers, idx) => magoDiv.appendChild(personagemCard(pers, idx)));

    // Aprendizes
    const aprendizDiv = document.getElementById('aprendiz-lista');
    aprendizDiv.innerHTML = '';
    personagens
        .filter(p => p.tipo === "Aprendiz")
        .forEach((pers, idx) => aprendizDiv.appendChild(personagemCard(pers, idx)));

    // Soldados
    const soldadoDiv = document.getElementById('soldado-lista');
    soldadoDiv.innerHTML = '';
    personagens
        .filter(p => p.tipo === "Soldado")
        .forEach((pers, idx) => soldadoDiv.appendChild(personagemCard(pers, idx)));

    renderSoldadoDropdown();
    renderSoldadoAlert();
}

function personagemCard(pers, idx) {
    let tipoStr = pers.tipo;
    let stats = STATS[pers.tipo] || STATS[pers.tipoSoldado] || {move:"-",fight:"-",shoot:"-",armor:"-",will:"-",hp:"-"};
    let name = pers.nome || pers.tipoSoldado || "";
    if (pers.tipo === "Mago") tipoStr = `<span class="tipo-mago">Mago</span>`;
    else if (pers.tipo === "Aprendiz") tipoStr = `<span class="tipo-aprendiz">Aprendiz</span>`;
    else if (SOLDADOS_NORMAIS.includes(pers.tipoSoldado)) tipoStr = `<span class="tipo-soldado">${pers.tipoSoldado}</span>`;
    else tipoStr = `<span class="soldado-elite">${pers.tipoSoldado||pers.tipo}</span>`;

    let card = document.createElement('div');
    card.className = 'person-card';
    let hpAtual = typeof pers.hpAtual === 'number' ? pers.hpAtual : stats.hp;
    card.innerHTML = `
        <div class="person-header">
            ${tipoStr} ${name ? ' - ' + name : ''}
            <button class="remove-btn" title="Remover" onclick="removerPersonagem(${idx})">✖</button>
        </div>
        <div class="stats-line">
            <span class="stat-label">Mov:</span><span class="stat-value">${stats.move}</span>
            <span class="stat-label">Fight:</span><span class="stat-value">${stats.fight}</span>
            <span class="stat-label">Shoot:</span><span class="stat-value">${stats.shoot}</span>
            <span class="stat-label">Armor:</span><span class="stat-value">${stats.armor}</span>
            <span class="stat-label">Will:</span><span class="stat-value">${stats.will}</span>
            <span class="stat-label">HP:</span>
            <span class="hp-box">
                <button class="hp-btn" onclick="alteraHP(${idx},-1)">-</button>
                <input class="hp-value" type="number" min="0" max="99" value="${hpAtual}" onchange="setHP(event,${idx})">
                <button class="hp-btn" onclick="alteraHP(${idx},1)">+</button>
            </span>
        </div>
        ${renderPersonagemMagias(idx)}
    `;
    return card;
}

function alteraHP(idx, delta) {
    let p = personagens[idx];
    let stats = STATS[p.tipo] || STATS[p.tipoSoldado] || {hp:10};
    if(typeof p.hpAtual !== "number") p.hpAtual = stats.hp;
    p.hpAtual = Math.max(0, Math.min(99, p.hpAtual + delta));
    renderPersonagens();
}
function setHP(e, idx) {
    let v = parseInt(e.target.value);
    let p = personagens[idx];
    let stats = STATS[p.tipo] || STATS[p.tipoSoldado] || {hp:10};
    v = isNaN(v) ? stats.hp : Math.max(0, Math.min(99, v));
    p.hpAtual = v;
    renderPersonagens();
}

function renderPersonagemMagias(idxPers) {
    if (!magiasPorPersonagem[idxPers] || magiasPorPersonagem[idxPers].length === 0) return '';
    return `<div class="person-magias"><b>Magias:</b><ul>` +
        magiasPorPersonagem[idxPers].map((m,i)=>
            `<li>${m.nome} <span style="color:#aaa;">[${m.escola}]</span> 
            <button class="remove-btn" onclick="removerMagiaPersonagem(${idxPers},${i})" title="Remover magia">✖</button>
            </li>`
        ).join('') + `</ul></div>`;
}
function removerMagiaPersonagem(idxPers, idxMagia) {
    magiasPorPersonagem[idxPers].splice(idxMagia,1);
    renderPersonagens();
}
function removerPersonagem(idx) {
    personagens.splice(idx, 1);
    delete magiasPorPersonagem[idx];
    let novoMagias = {};
    personagens.forEach((_,i) => {
        if (magiasPorPersonagem[i]) novoMagias[i] = magiasPorPersonagem[i];
    });
    magiasPorPersonagem = novoMagias;
    renderPersonagens();
}
function adicionarMago() {
    if (personagens.find(p => p.tipo === "Mago")) return alert("Só pode haver um mago!");
    let idx = personagens.length;
    personagens.push({tipo: "Mago", nome: "Mago", hpAtual: STATS["Mago"].hp});
    renderPersonagens();
}
function adicionarAprendiz() {
    if (personagens.find(p => p.tipo === "Aprendiz")) return alert("Só pode haver um aprendiz!");
    let idx = personagens.length;
    personagens.push({tipo: "Aprendiz", nome: "Aprendiz", hpAtual: STATS["Aprendiz"].hp});
    renderPersonagens();
}
function adicionarSoldado(e) {
    e.preventDefault();
    let tipoSoldado = document.getElementById('soldado-tipo').value;
    let nome = document.getElementById('soldado-nome').value;
    let norm = personagens.filter(p => SOLDADOS_NORMAIS.includes(p.tipoSoldado)).length;
    let elite = personagens.filter(p => SOLDADOS_ELITES.includes(p.tipoSoldado)).length;
    if (SOLDADOS_NORMAIS.includes(tipoSoldado) && norm >= 4)
        return alert("Máximo de 4 soldados normais!");
    if (SOLDADOS_ELITES.includes(tipoSoldado) && elite >= 4)
        return alert("Máximo de 4 soldados elite!");
    if (norm+elite >= 8)
        return alert("Máximo de 8 soldados!");
    personagens.push({tipo: "Soldado", tipoSoldado, nome, hpAtual: STATS[tipoSoldado]?.hp||10});
    renderPersonagens();
    e.target.reset();
}
function renderSoldadoDropdown() {
    let soldadoSel = document.getElementById('soldado-tipo');
    let norm = personagens.filter(p => SOLDADOS_NORMAIS.includes(p.tipoSoldado)).length;
    let elite = personagens.filter(p => SOLDADOS_ELITES.includes(p.tipoSoldado)).length;
    soldadoSel.innerHTML = `<optgroup label="Normais">` +
        SOLDADOS_NORMAIS.map(k => `<option value="${k}"${norm>=4?' disabled':''}>${k}</option>`).join('') +
        `</optgroup><optgroup label="Elites">` +
        SOLDADOS_ELITES.map(k => `<option value="${k}"${elite>=4?' disabled':''}>${k}</option>`).join('') +
        `</optgroup>`;
}
function renderSoldadoAlert() {
    let norm = personagens.filter(p => SOLDADOS_NORMAIS.includes(p.tipoSoldado)).length;
    let elite = personagens.filter(p => SOLDADOS_ELITES.includes(p.tipoSoldado)).length;
    let total = norm+elite;
    let alertDiv = document.getElementById('soldado-limit-alert');
    let msg = "";
    if (total >= 8) msg = "Limite total de 8 soldados atingido!";
    else if (norm >= 4) msg = "Limite de 4 soldados normais atingido.";
    else if (elite >= 4) msg = "Limite de 4 soldados elite atingido.";
    alertDiv.textContent = msg;
}

//--- Bestiário agrupado, selecionável e editável ---
const bestiario = [
    {nome:"Giant Rat", tipo:"Animal", desc:"Roedor agressivo e rápido.", explicacao:"Geralmente aparecem em grupos. Pequenos, mas podem causar problemas se ignorados.", stats:{move:7, fight:"+0", shoot:"-", armor:8, will:"-1", hp:6}},
    {nome:"Bear", tipo:"Animal", desc:"Urso feroz.", explicacao:"Alto dano em combate, resistente.", stats:{move:6, fight:"+4", shoot:"-", armor:12, will:"0", hp:16}},
    {nome:"Skeleton", tipo:"Morto-vivo", desc:"Guarda esquelético, imune a venenos.", explicacao:"Imune a veneno, não pode ser curado.", stats:{move:6, fight:"+1", shoot:"-", armor:12, will:"+0", hp:10}},
    {nome:"Zombie", tipo:"Morto-vivo", desc:"Lento mas persistente.", explicacao:"Muito difícil de derrubar, não pode correr.", stats:{move:4, fight:"+0", shoot:"-", armor:12, will:"-2", hp:12}},
    {nome:"Snow Troll", tipo:"Troll", desc:"Troll das neves, regenera.", explicacao:"Regenera HP a cada turno.", stats:{move:6, fight:"+4", shoot:"-", armor:14, will:"+3", hp:18}},
    {nome:"Demon (Minor)", tipo:"Demônio", desc:"Demoníaco menor.", explicacao:"Imune a medo e veneno. Pode aparecer em magias.", stats:{move:6, fight:"+2", shoot:"-", armor:12, will:"+2", hp:12}}
    // ... adicione mais criaturas conforme necessário ...
];

function agrupaBestiarioPorTipo(lista) {
    const grupos = {};
    lista.forEach(c => {
        if(!grupos[c.tipo]) grupos[c.tipo] = [];
        grupos[c.tipo].push(c);
    });
    return grupos;
}

function renderActiveBeasts() {
    const div = document.getElementById('active-beasts-list');
    if (!bestiarioAtivo.length) {
        div.innerHTML = '';
        return;
    }
    div.innerHTML = bestiarioAtivo.map((b, idx) => `
        <div class="active-beast-card">
            <div class="beast-header">
                ${b.nome}
                <span class="beast-type">[${b.tipo}]</span>
                <button class="remove-btn" onclick="removerBeastAtivo(${idx})" title="Remover da mesa">✖</button>
            </div>
            <div class="beast-desc beast-tooltip">
                ${b.desc}
                <span class="tooltiptext">${b.explicacao||""}</span>
            </div>
            <div class="stats-line">
                <span class="stat-label">Mov:</span><span class="stat-value">${b.stats.move}</span>
                <span class="stat-label">Fight:</span><span class="stat-value">${b.stats.fight}</span>
                <span class="stat-label">Shoot:</span><span class="stat-value">${b.stats.shoot}</span>
                <span class="stat-label">Armor:</span><span class="stat-value">${b.stats.armor}</span>
                <span class="stat-label">Will:</span><span class="stat-value">${b.stats.will}</span>
                <span class="stat-label">HP:</span>
                <span class="hp-box">
                    <button class="hp-btn" onclick="alteraHPBeastAtivo(event,${idx},-1)">-</button>
                    <input class="hp-value" type="number" min="0" max="99" value="${b.hpAtual}" style="width:2.5em;text-align:center;" onchange="setHPBeastAtivo(event,${idx})">
                    <button class="hp-btn" onclick="alteraHPBeastAtivo(event,${idx},1)">+</button>
                </span>
            </div>
        </div>
    `).join("");
}

function removerBeastAtivo(idx) {
    bestiarioAtivo.splice(idx,1);
    renderActiveBeasts();
}
function alteraHPBeastAtivo(event, idx, delta) {
    event.stopPropagation();
    bestiarioAtivo[idx].hpAtual = Math.max(0, Math.min(99, bestiarioAtivo[idx].hpAtual + delta));
    renderActiveBeasts();
}
function setHPBeastAtivo(event, idx) {
    let v = parseInt(event.target.value);
    v = isNaN(v) ? bestiarioAtivo[idx].stats.hp : Math.max(0, Math.min(99, v));
    bestiarioAtivo[idx].hpAtual = v;
    renderActiveBeasts();
}
function renderBestiario() {
    renderActiveBeasts();
    const div = document.getElementById('bestiary-list');
    const grupos = agrupaBestiarioPorTipo(bestiario);
    div.innerHTML = Object.keys(grupos).sort().map(tipo => `
        <div class="bestiary-group">
            <h3>${tipo}</h3>
            <div style="display:flex;flex-direction:column;gap:1.2em;">
                ${grupos[tipo].map((b, idx) =>
                    `<div class="beast-card">
                        <div class="beast-header">
                            <span class="beast-tooltip">${b.nome}
                                <span class="tooltiptext">${b.explicacao||""}</span>
                            </span>
                            <span class="beast-type">[${b.tipo}]</span>
                            <button class="select-beast-btn${isBeastAtivo(b)?' selected':''}" onclick="toggleBeastAtivo('${b.nome.replace(/'/g,"\\'")}','${b.tipo.replace(/'/g,"\\'")}')">
                                ${isBeastAtivo(b) ? "✓ na mesa" : "+"}
                            </button>
                        </div>
                        <div class="beast-desc">${b.desc||""}</div>
                        <div class="stats-line">
                            <span class="stat-label">Mov:</span><span class="stat-value">${b.stats.move}</span>
                            <span class="stat-label">Fight:</span><span class="stat-value">${b.stats.fight}</span>
                            <span class="stat-label">Shoot:</span><span class="stat-value">${b.stats.shoot}</span>
                            <span class="stat-label">Armor:</span><span class="stat-value">${b.stats.armor}</span>
                            <span class="stat-label">Will:</span><span class="stat-value">${b.stats.will}</span>
                            <span class="stat-label">HP:</span><span class="stat-value">${b.stats.hp}</span>
                        </div>
                    </div>`
                ).join("")}
            </div>
        </div>
    `).join("");
}
function isBeastAtivo(b) {
    return bestiarioAtivo.find(a => a.nome === b.nome && a.tipo === b.tipo);
}
function toggleBeastAtivo(nome, tipo) {
    const idx = bestiarioAtivo.findIndex(b=>b.nome===nome && b.tipo===tipo);
    if(idx >= 0) {
        bestiarioAtivo.splice(idx,1);
    } else {
        const base = bestiario.find(b=>b.nome===nome && b.tipo===tipo);
        if(base) bestiarioAtivo.unshift({...base, hpAtual: base.stats.hp});
    }
    renderBestiario();
}

// --- Abas: tornadas clicáveis ---
document.getElementById('tabnav').addEventListener('click', function(e) {
    if(e.target.tagName === "BUTTON") {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        let tab = e.target.getAttribute('data-tab');
        document.querySelectorAll('.tab-content').forEach(tabEl => tabEl.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        if(tab === 'dashboard') renderPersonagens();
        if(tab === 'bestiario') renderBestiario();
        // Adicione chamadas para magias/itens se necessário
        if (tab === 'magias') { renderMagiaDropdown && renderMagiaDropdown(); renderBancoMagias && renderBancoMagias(); }
        if (tab === 'itens') { renderItemDropdown && renderItemDropdown(); renderBancoItens && renderBancoItens(); }
    }
});

// --- Inicialização ---
window.onload = function() {
    renderPersonagens();
    renderBestiario();
    // Adicione inicialização de magias/itens se necessário
    if (typeof renderMagiaDropdown === "function") renderMagiaDropdown();
    if (typeof renderBancoMagias === "function") renderBancoMagias();
    if (typeof renderItemDropdown === "function") renderItemDropdown();
    if (typeof renderBancoItens === "function") renderBancoItens();
};
</script>
</body>
</html>
